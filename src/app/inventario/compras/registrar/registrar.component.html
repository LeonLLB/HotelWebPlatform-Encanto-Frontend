<app-center-box>
    <form 
        [formGroup]="compraForm"
        autocomplete="off"
        (ngSubmit)="registerCompraSubmit()"
        class="h-fit space-y-3 grid grid-cols-2 items-center bg-slate-200 shadow-lg py-6 px-8 rounded-lg"
    >
        <h1 class="text-xl text-center col-span-2 -mt-4">{{ (isEditableForm) ? 'Modificar compra' :  'Registrar una compra'}}</h1>
        <div>
            <app-input [formGroup]="compraForm" max="tomorrowDate" type="date" inputName="fechaCompra" label="Fecha de la compra"></app-input>
        </div>
        <div [Block]="isFetchingProveedores">
            <app-simple-select *ngIf="!isFetchingProveedores"
            formControlName="proveedor"
            [formGroup]="compraForm"
            [inputOptions]="avaliablesProveedores"
            label="Proveedor"
            ></app-simple-select>
        </div>
        <div>
            <app-input [formGroup]="compraForm" type="number" inputName="baseImponible" label="Base Imponible (B.I.G)"></app-input>
        </div>
        <div>
            <app-input [formGroup]="compraForm" type="number" inputName="exento" label="Exento"></app-input>
        </div>
        <div>
            <app-input [formGroup]="compraForm" min="1" type="number" inputName="porcentajeIVA" label="Porcentaje de IVA"></app-input>
        </div>
        <div class="flex flex-row justify-end">
            <button [Block]="isFetchingArticulos" (click)="addArticuloToForm()" type="button" class="btn-action-primary mt-2">AÃ±adir articulo a la compra</button>
        </div>
        <div *ngIf="hasAddedArticulo" class="col-span-2 w-full flex flex-col">
            <div class="mb-2 grid grid-cols-3" *ngFor="additionalArticulos.controls; let i = index">
                <div class="grid-cols-1 grid w-full ml-7 space-y-2">
                    <hwp-arr-simple-select
                        formArrayName="articulos"
                        [formGroup]="compraForm"
                        type="text"                        
                        [inputIndex]="i"  
                        [inputOptions]="avaliablesArticulos"
                        label="Articulo"
                    ></hwp-arr-simple-select>               
                </div>            
                <div class="grid-cols-1 grid w-full ml-7 space-y-2">
                    <app-arr-input
                        formArrayName="cantidades"
                        [formGroup]="compraForm"
                        class="w-auto"
                        type="text"                        
                        [inputIndex]="i"
                    ></app-arr-input>
                </div>            
                <div class="grid-cols-1 w-2/3 ml-3 place-items-center grid mt-1">
                    <button type="button" (click)="deleteInputFromArr(i)" class="text-xs h-4 w-full !py-0 btn-action-primary-small">
                        Borrar
                    </button>
                </div>
            </div>
        </div>
        <div class="col-span-2 w-full flex flex-row justify-center">
            <button type="submit" class="btn-action-primary mt-2">{{(isEditableForm) ? 'Modificar compra' :'Registrar compra'}}</button>
        </div>

    </form>
</app-center-box>

